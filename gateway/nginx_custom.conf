# -----------------------------------------------------------------------------
# Nginx Custom Configuration for Kong Gateway
#
# Mục đích:
# 1. Định nghĩa một định dạng log truy cập (access log) chi tiết hơn.
# 2. Chuyển hướng access log ra stdout để Docker có thể thu thập.
# 3. Chuyển hướng error log ra stderr để Docker có thể thu thập.
# -----------------------------------------------------------------------------

# Định dạng log tùy chỉnh bao gồm các thông tin hữu ích như:
# - $remote_addr: Địa chỉ IP của client
# - $remote_user: Tên người dùng (nếu có xác thực HTTP Basic)
# - $time_local: Thời gian local của server
# - $request: Dòng request gốc (ví dụ: "GET /path HTTP/1.1")
# - $status: Mã trạng thái HTTP trả về (ví dụ: 200, 404)
# - $body_bytes_sent: Kích thước body trả về (tính bằng byte)
# - $http_referer: URL trang giới thiệu (nếu có)
# - $http_user_agent: Thông tin trình duyệt/client
# - [$service_name/$route_name]: Tên Service và Route của Kong đã xử lý request (nếu có)
# - rt=$request_time: Tổng thời gian xử lý request (tính bằng giây)
# - ua=$upstream_addr: Địa chỉ của backend service đã nhận request
# - us=$upstream_status: Mã trạng thái HTTP trả về từ backend
# - ut=$upstream_response_time: Thời gian phản hồi từ backend
log_format custom_kong_format '$remote_addr - $remote_user [$time_local] "$request" '
                            '$status $body_bytes_sent "$http_referer" '
                            '"$http_user_agent" [$service_name/$route_name] '
                            'rt=$request_time ua=$upstream_addr us=$upstream_status ut=$upstream_response_time';

# Chỉ thị Nginx để sử dụng định dạng log tùy chỉnh và ghi vào stdout
# /dev/stdout là một đường dẫn đặc biệt trỏ đến standard output trong môi trường Linux/Unix
access_log /dev/stdout custom_kong_format;

# Chỉ thị Nginx để ghi error log (với mức độ 'warn' trở lên) vào stderr
# /dev/stderr là một đường dẫn đặc biệt trỏ đến standard error
error_log /dev/stderr warn;